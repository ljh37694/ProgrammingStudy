<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link rel="stylesheet" href="/style.css">
    </head>
    <body class="grey-bg">
        <%- include("nav.ejs"); %>
        <div>        
            <input id="search-input">
            <button id="search-btn">Í≤ÄÏÉâ</button>
        </div>
        
        <div class="white-bg">
            <% data.forEach((post) => { %>
                <div class="list-box">
                    <h4>
                        <%= post.title %>
                        <a href="/detail/<%= post._id %>">ÎßÅÌÅ¨</a> 
                        <a href="/edit/<%= post._id %>" style="text-decoration-line: none;">‚úèÔ∏è</a>
                        <% if (post.user.equals(user._id )) { %>
                            <span class="del-btn" style="cursor: pointer;" data-id="<%= post._id %>">üóëÔ∏è</span>
                        <% } %>
                    </h4>
                    <p><%= post.content %></p>
                </div>
            <% }); %>
          </div>

          <script>
            const delBtn = document.querySelectorAll(".del-btn");

            for (let i = 0; i < delBtn.length; i++) {
                delBtn[i].addEventListener("click", (e) => {
                    let postId = e.target.dataset.id;

                    fetch(`/delete-post?id=${postId}`, {
                        method : "DELETE",
                    });

                    e.target.parentElement.parentElement.style.display = "none";
                });
            }

            document.querySelector("#search-btn").addEventListener("click", (e) => {
                let text = document.querySelector("#search-input").value;

                fetch(`/list/search/${text}`, {
                        method : "GET"
                });

                window.location.href = `/list/search/${text}`;
            });
          </script>
    </body>
</html>
